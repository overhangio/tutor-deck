{% extends "plugin_header.html" %}

{% set sidebar_active_tab = "" %}

{% from 'switch_macro.html' import switch %}

{% if is_installed %}
{% block plugin_description %}
{% endblock %}
{% endif %}

{% block workspace_content %}

{% if is_installed %}
<div class="status">
    <div class="status-text">
        Status
    </div>
    {{ switch(plugin_name, is_enabled) }}
    <div class="switch-text">
        <div class="title">
            {% if is_enabled %} Enabled {% else %} Disabled {% endif %}
        </div>
        <div class="description">
            {% if not is_enabled %} Enable the plugin to edit parameters. {% endif %}
        </div>
    </div>
</div>
{% endif %}

{% if is_enabled and not show_logs %}
<div class="parameter-info">
    <h2>Plugin Parameters</h2>
    <p>This plugin has default parameters. If you make any changes, save them and run a local launch to make the changes effective.</p>
</div>

<h3>Unique settings</h3>
{% if plugin_config_unique %}
{% with config=plugin_config_unique %}{% include "_config.html" %}{% endwith %}
{% else %}
<p>None defined</p>
{% endif %}

<h3>Default settings</h3>
{% if plugin_config_defaults %}
{% with config=plugin_config_defaults %}{% include "_config.html" %}{% endwith %}
{% else %}
<p>None defined</p>
{% endif %}

{% endif %}

{% if show_logs %}
    <div class="tutor-logs-container">
        <pre id="tutor-logs" hx-ext="sse" sse-connect="{{ url_for('cli_logs_stream') }}" sse-swap="logs"></pre>
    </div>
{% endif %}

{% endblock %}

{% block scripts %}
<script>
    htmx.on("htmx:sseBeforeMessage", function(evt) {
        // Don't swap content, we want to append
        evt.preventDefault();

        // Parse JSON
        const stdout = JSON.parse(evt.detail.data);

        // Note that HTML is automatically escaped
        const text = document.createTextNode(stdout);
        evt.detail.elt.appendChild(text);

        // Scroll to bottom
        evt.detail.elt.scrollTop = evt.detail.elt.scrollHeight;
    });
</script>
{% endblock %}
