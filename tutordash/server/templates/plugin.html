{% extends "_plugin_header.html" %}

{% set sidebar_active_tab = "" %}

{% from '_switch.html' import switch %}

{% block workspace_content %}
<div class="status" id="plugin-enable-disable-bar">
    <div class="status-text">
        Status
    </div>
    {{ switch(plugin_name, is_enabled) }}
    <div class="switch-text">
        <div class="title">
            {% if is_enabled %} Enabled {% else %} Disabled {% endif %}
        </div>
        <div class="description">
            {% if not is_enabled %} Enable the plugin to edit parameters. {% endif %}
        </div>
    </div>
</div>

{% if is_enabled and not show_logs %}
<div class="parameter-info">
    <h2>Plugin Parameters</h2>
    <p>This plugin has default parameters. If you make any changes, save them and run a local launch to make the changes effective.</p>
</div>

<h3>Unique settings</h3>
{% if plugin_config_unique %}
{% with config=plugin_config_unique %}{% include "_config.html" %}{% endwith %}
{% else %}
<p>None defined</p>
{% endif %}

<h3>Default settings</h3>
{% if plugin_config_defaults %}
{% with config=plugin_config_defaults %}{% include "_config.html" %}{% endwith %}
{% else %}
<p>None defined</p>
{% endif %}

{% endif %}

{% if show_logs %}
    <div class="tutor-logs-container">
        <pre id="tutor-logs" hx-ext="sse" sse-connect="{{ url_for('cli_logs_stream') }}" sse-swap="logs"></pre>
    </div>
{% endif %}

{% endblock %}

{% block scripts %}
    <script>
        window.pluginName = '{{ plugin_name }}';
        window.pluginIsInstalled = '{% if is_installed %}true{% else %}false{% endif %}' === 'true'
        function togglePluginEnableDisableBar(show) {
            const bar = document.getElementById('plugin-enable-disable-bar');
            bar.style.display = show===true ? 'flex' : 'none';
        }
        togglePluginEnableDisableBar(window.pluginIsInstalled);

        window.show_logs = '{{ show_logs }}' === 'True';
        window.plugin_upgrade_button = document.getElementById('plugin-upgrade-button')
        window.plugin_install_button = document.getElementById('plugin-install-button')
        window.cancel_command_button = document.getElementById('cancel-command-button')
        function showPluginInstallButton(){
            window.plugin_install_button.style.display = 'flex';
            window.plugin_upgrade_button.style.display = 'none'; 
            window.cancel_command_button.style.display = 'none'; 
        }
        function showPluginUpgradeButton(){
            window.plugin_install_button.style.display = 'none';
            window.plugin_upgrade_button.style.display = 'flex'; 
            window.cancel_command_button.style.display = 'none'; 
        }
        function showCancelButton(){
            window.plugin_install_button.style.display = 'none';
            window.plugin_upgrade_button.style.display = 'none'; 
            window.cancel_command_button.style.display = 'flex'; 
        }
        function showPluginPageButton(){
            if (window.pluginIsInstalled){
                showPluginUpgradeButton();
            } else {
                showPluginInstallButton();
            }
        }
        if (window.show_logs){
            showCancelButton();
        } else {
            showPluginPageButton();
        }
    </script>
    <script src="{{ url_for('static', filename='js/logs.js') }}"></script>
{% endblock %}
